<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.springProject1.rec.dao.RecDao">

	<!-- insert -->
	<insert id="setExerciseRecord">
		INSERT INTO ExerciseRecord (
		user_id, exercise_id, duration_minutes,
		calories_burned, activity_date, source_platform
		)
		VALUES (
		#{user_id}, #{exercise_id}, #{duration_minutes},
		#{calories_burned}, #{activity_date}, #{source_platform}
		)
	</insert>

	<insert id="setMealRecord" parameterType="com.spring.springProject1.rec.MealRecordVo">
		INSERT INTO MealRecord (
		user_id, food_id, meal_time, quantity, meal_date, recorded_at
		)
		VALUES (
		#{user_id}, #{food_id}, #{meal_time}, #{quantity}, #{meal_date}, NOW()
		)
	</insert>



	<!-- select -->
	<select id="getExerciseRecordList" resultType="com.spring.springProject1.rec.ExerciseRecordVo">
		SELECT er.*, ei.name AS exercise_name
		FROM ExerciseRecord er
		JOIN ExerciseInfo ei ON er.exercise_id = ei.exercise_id
		WHERE er.user_id = #{user_id}
		AND ei.is_active = true
		ORDER BY er.activity_date DESC
	</select>

	<select id="getExerciseRecordById" resultType="com.spring.springProject1.rec.ExerciseRecordVo">
		SELECT er.*, ei.name AS exercise_name
		FROM ExerciseRecord er
		JOIN ExerciseInfo ei ON er.exercise_id = ei.exercise_id
		WHERE er.record_id = #{record_id}
		AND er.user_id = #{user_id}
	</select>

	<select id="getMealRecordList" resultType="com.spring.springProject1.rec.MealRecordVo">
		SELECT mr.*, fi.name AS food_name
		FROM MealRecord mr
		JOIN FoodInfo fi ON mr.food_id = fi.food_id
		WHERE mr.user_id = #{user_id}
		AND fi.is_active = TRUE
		ORDER BY mr.meal_date DESC
	</select>

	<select id="getMealRecordById" resultType="com.spring.springProject1.rec.MealRecordVo">
		SELECT mr.*, fi.name AS food_name
		FROM MealRecord mr
		JOIN FoodInfo fi ON mr.food_id = fi.food_id
		WHERE mr.meal_id = #{meal_id}
		AND mr.user_id = #{user_id}
		AND fi.is_active = TRUE
	</select>







	<!-- update -->
	<update id="updateExerciseRecord">
		UPDATE ExerciseRecord
		SET
		duration_minutes = #{duration_minutes},
		calories_burned = #{calories_burned},
		activity_date = #{activity_date},
		source_platform = #{source_platform}
		WHERE record_id = #{record_id} AND user_id = #{user_id}
	</update>

	<update id="updateMealRecord">
		UPDATE MealRecord
		SET
		food_id = #{vo.food_id},
		meal_time = #{vo.meal_time},
		quantity = #{vo.quantity},
		meal_date = #{vo.meal_date}
		WHERE meal_id = #{vo.meal_id}
		AND user_id = #{vo.user_id}
	</update>





	<!-- delete -->
	<delete id="deleteExerciseRecord">
		DELETE FROM ExerciseRecord
		WHERE record_id = #{record_id}
		AND user_id = #{user_id}
	</delete>

	<delete id="multiDeleteExerciseRecord">
		DELETE FROM ExerciseRecord
		WHERE record_id IN
		<foreach collection="recordIdList" item="id" open="(" separator="," close=")">
			#{id}
		</foreach>
		AND user_id = #{user_id}
	</delete>

	<delete id="deleteMealRecord">
		DELETE FROM MealRecord
		WHERE meal_id = #{meal_id}
		AND user_id = #{user_id}
	</delete>

	<delete id="multiDeleteMealRecord">
		DELETE FROM MealRecord
		WHERE meal_id IN
		<foreach collection="recordIdList" item="id" open="(" separator="," close=")">
			#{id}
		</foreach>
		AND user_id = #{user_id}
	</delete>
	






</mapper>