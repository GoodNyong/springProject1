<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.springProject1.rec.dao.RecDao">

	<!-- insert -->
	<insert id="setExerciseRecord">
		INSERT INTO ExerciseRecord (
		user_id, exercise_id, duration_minutes,
		calories_burned, activity_date, source_platform
		)
		VALUES (
		#{user_id}, #{exercise_id}, #{duration_minutes},
		#{calories_burned}, #{activity_date}, #{source_platform}
		)
	</insert>

	<insert id="setMealRecord" parameterType="MealRecordVo">
		INSERT INTO MealRecord (
		user_id, food_id, meal_time, quantity, meal_date, recorded_at
		)
		VALUES (
		#{user_id}, #{food_id}, #{meal_time}, #{quantity}, #{meal_date}, NOW()
		)
	</insert>

	<insert id="insertExerciseGoal" parameterType="ExerciseGoalVo">
		insert into ExerciseGoal
		(goal_id, user_id, exercise_id, set_by, expert_id,
		target_value, target_type, goal_unit, start_date, end_date)
		values
		(default, #{user_id}, #{exercise_id}, #{set_by}, #{expert_id},
		#{target_value}, #{target_type}, #{goal_unit}, #{start_date}, #{end_date})
	</insert>

	<!-- 식단 목표 등록 -->
	<insert id="insertNutritionGoal" parameterType="NutritionGoalVo">
		insert into NutritionGoal
		(goal_id, user_id, goal_type, nutrient_id, food_id, set_by, expert_id,
		quantity, target_value, goal_unit, start_date, end_date)
		values
		(default, #{user_id}, #{goal_type}, #{nutrient_id}, #{food_id}, #{set_by}, #{expert_id},
		#{quantity}, #{target_value}, #{goal_unit}, #{start_date}, #{end_date})
	</insert>




	<!-- select -->
	<select id="getExerciseRecordList" resultType="ExerciseRecordVo">
		SELECT er.*, ei.name AS exercise_name
		FROM ExerciseRecord er
		JOIN ExerciseInfo ei ON er.exercise_id = ei.exercise_id
		WHERE er.user_id = #{user_id}
		AND ei.is_active = true
		ORDER BY er.activity_date DESC
	</select>

	<select id="getExerciseRecordById" resultType="ExerciseRecordVo">
		SELECT er.*, ei.name AS exercise_name
		FROM ExerciseRecord er
		JOIN ExerciseInfo ei ON er.exercise_id = ei.exercise_id
		WHERE er.record_id = #{record_id}
		AND er.user_id = #{user_id}
	</select>

	<select id="getMealRecordList" resultType="MealRecordVo">
		SELECT mr.*, fi.name AS food_name
		FROM MealRecord mr
		JOIN FoodInfo fi ON mr.food_id = fi.food_id
		WHERE mr.user_id = #{user_id}
		AND fi.is_active = TRUE
		ORDER BY mr.meal_date DESC
	</select>

	<select id="getMealRecordById" resultType="MealRecordVo">
		SELECT mr.*, fi.name AS food_name
		FROM MealRecord mr
		JOIN FoodInfo fi ON mr.food_id = fi.food_id
		WHERE mr.meal_id = #{meal_id}
		AND mr.user_id = #{user_id}
		AND fi.is_active = TRUE
	</select>

	<select id="getExerciseGoalList" parameterType="int" resultType="ExerciseGoalVo">
		SELECT
		g.goal_id, g.user_id, g.exercise_id, g.set_by, g.expert_id,
		g.target_value, g.target_type, g.goal_unit,
		g.start_date, g.end_date,
		e.name as exercise_name
		FROM ExerciseGoal g
		JOIN ExerciseInfo e on g.exercise_id = e.exercise_id
		WHERE g.user_id = #{user_id}
		ORDER by g.start_date asc
	</select>

	<select id="getExerciseGoalById" resultType="ExerciseGoalVo">
		SELECT g.*, e.name AS exercise_name
		FROM ExerciseGoal g
		JOIN ExerciseInfo e ON g.exercise_id = e.exercise_id
		WHERE g.goal_id = #{goal_id}
		AND g.user_id = #{user_id}
	</select>

	<!-- 식품 전체 목록 조회 -->
	<select id="getAllFoodList" resultType="FoodInfoVo">
		select food_id, name, category, calories, carbohydrates,
		protein, fat, source, is_active
		from FoodInfo
		where is_active = 1
		order by name asc
	</select>

	<select id="getNutritionGoalList" parameterType="int" resultType="NutritionGoalVo">
		select
		ng.goal_id, ng.user_id, ng.goal_type, ng.nutrient_id, ng.food_id,
		ng.set_by, ng.expert_id, ng.quantity,
		ng.target_value, ng.goal_unit, ng.start_date, ng.end_date,
		fi.name as food_name
		from NutritionGoal ng
		left join FoodInfo fi on ng.food_id = fi.food_id
		where ng.user_id = #{user_id}
		order by ng.start_date desc
	</select>










	<!-- update -->
	<update id="updateExerciseRecord">
		UPDATE ExerciseRecord
		SET
		duration_minutes = #{duration_minutes},
		calories_burned = #{calories_burned},
		activity_date = #{activity_date},
		source_platform = #{source_platform}
		WHERE record_id = #{record_id} AND user_id = #{user_id}
	</update>

	<update id="updateMealRecord">
		UPDATE MealRecord
		SET
		food_id = #{vo.food_id},
		meal_time = #{vo.meal_time},
		quantity = #{vo.quantity},
		meal_date = #{vo.meal_date}
		WHERE meal_id = #{vo.meal_id}
		AND user_id = #{vo.user_id}
	</update>

	<update id="updateExerciseGoal">
		UPDATE ExerciseGoal
		SET exercise_id = #{exercise_id},
		target_type = #{target_type},
		target_value = #{target_value},
		goal_unit = #{goal_unit},
		start_date = #{start_date},
		end_date = #{end_date}
		WHERE goal_id = #{goal_id}
		AND user_id = #{user_id}
	</update>





	<!-- delete -->
	<delete id="deleteExerciseRecord">
		DELETE FROM ExerciseRecord
		WHERE record_id = #{record_id}
		AND user_id = #{user_id}
	</delete>

	<delete id="multiDeleteExerciseRecord">
		DELETE FROM ExerciseRecord
		WHERE record_id IN
		<foreach collection="recordIdList" item="id" open="(" separator="," close=")">
			#{id}
		</foreach>
		AND user_id = #{user_id}
	</delete>

	<delete id="deleteMealRecord">
		DELETE FROM MealRecord
		WHERE meal_id = #{meal_id}
		AND user_id = #{user_id}
	</delete>

	<delete id="multiDeleteMealRecord">
		DELETE FROM MealRecord
		WHERE meal_id IN
		<foreach collection="recordIdList" item="id" open="(" separator="," close=")">
			#{id}
		</foreach>
		AND user_id = #{user_id}
	</delete>

	<delete id="deleteExerciseGoal">
		DELETE FROM ExerciseGoal
		WHERE goal_id = #{goal_id}
		AND user_id = #{user_id}
	</delete>

	<delete id="deleteExerciseGoals">
		DELETE FROM ExerciseGoal
		WHERE user_id = #{user_id}
		AND goal_id IN
		<foreach collection="goalIds" item="id" open="(" close=")" separator=",">
			#{id}
		</foreach>
	</delete>









</mapper>